This file contains example outputs from nikss-ctl command under different options and externs.

# Error, warning and informational messages

All informational, error and warning messages are printed to the `stderr` stream (with exceptions, see note below). Such
sentence has a form of sentence with additional context and decoded error code value if available. Some sentences starting
with keyword `libbpf:` are generated by `libbpf` library itself. When error occurs code other than `0` is returned and
this code is related to standard `errno` values.

There is no used prefix to point severity of the output sentence.

**Note**: As of October 2022 there is no simple way to disable these messages. One option is to redirect `stderr` stream
to the `/dev/null`, but some messages are still printed to the `stdout` stream. Messages may be printed to the `stdout`
by the following commands:
- `clone-session add-member`
- `clone-session create`
- `multicast-group add-member`
- `multicast-group create`
- `pipeline load`
- `pipeline unload`

# Field names reflection

Many externs accept `int`-like types as well (nested) structures as a key/index/value type.

In the first scenario generated field name will be always `field0`. Let's define  for example `Meter` in the following way
in P4 code:
```p4
Meter<bit<32>>(128, PSA_MeterType_t.BYTES) meter;
```
The generated JSON for meter index will be following:
```json
"index": {
    "field0": "0x63"
}
```
Name of field `field0` is generated by the P4C compiler and will always have that name, because P4 program specify only
the type of key/index/value but no name is provided. To simplify API for these fields with `int`-like type they are treated
in the same way as complex indexes with nested structures (see below for example).

In the second scenario names of fields will be used to generate output JSON (type names are ignored). Let's define  for
example `Meter` in the following way in P4 code:
```p4
struct nested {
    bit<16> nested_field;
}

struct type1 {
    bit<16> field0;
    nested nested_struct;
}

Meter<type1>(128, PSA_MeterType_t.BYTES) meter;
```
The generated JSON for meter index will be following:
```json
"index": {
    "field0": "0x1",
    "nested_struct": {
        "nested_field": "0x2"
    }
}
```

When referring (nested) structures in command line just place value of each field one by one, ignoring nesting structures.
For the above example index value for the `meter update` command would be `... index 0x1 0x2 ...`.

# Data outputs

Useful data for other applications are printed to the `stdout` stream in the JSON format. General template of the output
JSON is following:
```
{
    "extern-name": {
        <extern specific fields and data>
    }
}
```

## ActionProfile

- Add member:
  ```json
  {
      "ingress_ap": {
          "added_member_ref": 1
      }
  }
  ```
  This reference is assigned by the library and have to be used in other commands to reference newly created member.

- Get all members:
  ```json
  {
      "ingress_ap": {
          "member_refs": {
              "1": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x1"
                      }
                  ]
              },
              "3": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x3"
                      }
                  ]
              },
              "2": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x2"
                      }
                  ]
              },
              "4": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x4"
                      }
                  ]
              }
          }
      }
  }
  ```
  Note that member references are not sorted, this is due to the fact that underlying eBPF map is unordered.

- Get single member:
  ```json
  {
      "ingress_ap": {
          "member_refs": {
              "1": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x1"
                      }
                  ]
              }
          }
      }
  }
  ```

## ActionSelector

- Add a new member:
  ```json
  {
      "ingress_as": {
          "added_member_ref": 1
      }
  }
  ```
  This reference is assigned by the library and have to be used in other commands to reference newly created member.

- Add a new group:
  ```json
  {
      "ingress_as": {
          "added_group_ref": 1
      }
  }
  ```
  This reference is assigned by the library and have to be used in other commands to reference newly created group.

- Get all data from extern:
  ```json
  {
      "ingress_as": {
          "member_refs": {
              "6": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x6"
                      }
                  ]
              },
              "4": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x4"
                      }
                  ]
              },
              "2": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x2"
                      }
                  ]
              },
              "3": {
                  "action_id": 2,
                  "action_name": "ingress_a2",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x3"
                      },
                      {
                          "name": "param2",
                          "value": "0x2c"
                      }
                  ]
              },
              "1": {
                  "action_id": 0,
                  "action_name": "_NoAction",
                  "action_parameters": []
              },
              "5": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x5"
                      }
                  ]
              }
          },
          "group_refs": {
              "1": {
                  "member_refs": []
              },
              "4": {
                  "member_refs": [
                      6,
                      4,
                      5
                  ]
              },
              "2": {
                  "member_refs": [
                      1
                  ]
              },
              "3": {
                  "member_refs": [
                      2,
                      3
                  ]
              }
          },
          "empty_group_action": {
              "action_id": 2,
              "action_name": "ingress_a2",
              "action_parameters": [
                  {
                      "name": "param",
                      "value": "0x2"
                  },
                  {
                      "name": "param2",
                      "value": "0x80"
                  }
              ]
          }
      }
  }
  ```
  
- Get single member:
  ```json
  {
      "ingress_as": {
          "member_refs": {
              "3": {
                  "action_id": 2,
                  "action_name": "ingress_a2",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x3"
                      },
                      {
                          "name": "param2",
                          "value": "0x2c"
                      }
                  ]
              }
          }
      }
  }
  ```
  
- Get single group (also prints related members):
  ```json
  {
      "ingress_as": {
          "member_refs": {
              "6": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x6"
                      }
                  ]
              },
              "4": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x4"
                      }
                  ]
              },
              "5": {
                  "action_id": 1,
                  "action_name": "ingress_a1",
                  "action_parameters": [
                      {
                          "name": "param",
                          "value": "0x5"
                      }
                  ]
              }
          },
          "group_refs": {
              "4": {
                  "member_refs": [
                      6,
                      4,
                      5
                  ]
              }
          }
      }
  }
  ```
  
- Get empty group action:
  ```json
  {
      "ingress_as": {
          "empty_group_action": {
              "action_id": 2,
              "action_name": "ingress_a2",
              "action_parameters": [
                  {
                      "name": "param",
                      "value": "0x2"
                  },
                  {
                      "name": "param2",
                      "value": "0x80"
                  }
              ]
          }
      }
  }
  ```

## Clone sessions

- List of all clone sessions:
  ```json
  {
      "clone_sessions": [
          {
              "id": 8,
              "entries": [
                  {
                      "port": 6,
                      "instance": 2,
                      "class_of_service": 1,
                      "truncate": false
                  },
                  {
                      "port": 6,
                      "instance": 1,
                      "class_of_service": 0,
                      "truncate": false
                  }
              ]
          },
          {
              "id": 10,
              "entries": [
                  {
                      "port": 7,
                      "instance": 25,
                      "class_of_service": 0,
                      "truncate": true,
                      "truncate_length": 1200
                  }
              ]
          }
      ]
  }
  ```
  
- Get single clone session
  ```json
  {
      "clone_sessions": [
          {
              "id": 10,
              "entries": [
                  {
                      "port": 7,
                      "instance": 25,
                      "class_of_service": 0,
                      "truncate": true,
                      "truncate_length": 1200
                  }
              ]
          }
      ]
  }
  ```

## Counter

Counter does not support complex keys, cannot be accessed using structures.

Getting all available entries will return similar JSON but with more entries.

- Get single counter entry:
  ```json
  {
      "ingress_cnt": {
          "entries": [
              {
                  "key": {
                      "field0": "0x1"
                  },
                  "value": {
                      "bytes": "0x0",
                      "packets": "0x0"
                  }
              }
          ],
          "type": "PACKETS_AND_BYTES"
      }
  }
  ```
  Possible `type` of Counter is following:
  - `PACKETS_AND_BYTES`
  - `PACKETS`
  - `BYTES`

## Digest

- Get first digest from the queue:
  ```json
  {
      "IngressDeparserImpl_mac_learn_digest": {
          "digests": [
              {
                  "srcAddr": "0xfafbfcfdfef0",
                  "ingress_port": "0x4"
              }
          ]
      }
  }
  ```

- Get all available digests from the queue:
  ```json
  {
      "IngressDeparserImpl_mac_learn_digest": {
          "digests": [
              {
                  "srcAddr": "0xfafbfcfdfef0",
                  "ingress_port": "0x4"
              },
              {
                  "srcAddr": "0xfafbfcfdfef0",
                  "ingress_port": "0x4"
              },
              {
                  "srcAddr": "0xfafbfcfdfef0",
                  "ingress_port": "0x4"
              }
          ]
      }
  }
  ```

## DirectCounter

See [Table](#table) section.

## DirectMeter

See [Table](#table) section.

## Meter

Getting all available entries will return similar JSON but with more entries. These entries are not guaranteed to be ordered
in any way and number of these entries might not be equal to declared size of extern in P4 program.

Note that detection whether meter instance meters packets or bytes is not possible using BTF, so such information is not
included in the output JSON.

- Get single meter entry with `int`-like index:
  ```json
  {
      "ingress_m_besteff": {
          "entries": [
              {
                  "index": {
                      "field0": "0x63"
                  },
                  "config": {
                      "pir": 250000,
                      "pbs": 2500,
                      "cir": 250000,
                      "cbs": 2500
                  }
              }
          ]
      }
  }
  ```

- Get single meter entry with complex index (nested structures):
  ```json
  {
      "ingress_meter": {
          "entries": [
              {
                  "index": {
                      "field0": "0x1",
                      "nested_struct": {
                          "nested_field": "0x2"
                      }
                  },
                  "config": {
                      "pir": 250000,
                      "pbs": 2500,
                      "cir": 250000,
                      "cbs": 2500
                  }
              }
          ]
      }
  }
  ```

## Multicast groups

- List of all multicast groups:
  ```json
  {
      "multicast_groups": [
          {
              "id": 8,
              "members": [
                  {
                      "port": 6,
                      "instance": 1
                  },
                  {
                      "port": 5,
                      "instance": 1
                  }
              ]
          },
          {
              "id": 10,
              "members": [
                  {
                      "port": 7,
                      "instance": 20
                  }
              ]
          }
      ]
  }
  ```
  
- Get single multicast group:
  ```json
  {
      "multicast_groups": [
          {
              "id": 10,
              "members": [
                  {
                      "port": 7,
                      "instance": 20
                  }
              ]
          }
      ]
  }
  ```

## Pipeline management

- Show pipeline status:
  ```json
  {
      "pipeline": {
          "id": 1,
          "load_time": "2022-06-27T13:24:00+0200",
          "bpf_hook": "TC",
          "has_egress_program": false,
          "ports": [
              {
                  "name": "psa_recirc",
                  "port_id": 2
              },
              {
                  "name": "eth0",
                  "port_id": 4
              },
              {
                  "name": "eth1",
                  "port_id": 5
              },
              {
                  "name": "eth2",
                  "port_id": 6
              },
              {
                  "name": "eth3",
                  "port_id": 7
              },
              {
                  "name": "eth4",
                  "port_id": 8
              },
              {
                  "name": "eth5",
                  "port_id": 9
              }
          ],
          "objects": [
              "ingress_upf_process_ingress_l4port_ingress_l4_src_port",
              "ingress_upf_process_ingress_l4port_ingress_l4_dst_port",
              "ingress_upf_ingress_source_interface_lookup_by_port",
              "ingress_upf_ingress_session_lookup_by_ue_ip",
              "ingress_upf_ingress_session_lookup_by_teid",
              "ingress_upf_ingress_pdr_lookup",
              "ingress_upf_ingress_far_lookup",
              "ingress_ip_forward_ipv4_lpm",
              "ingress_upf_process_ingress_l4port_ingress_l4port_fields"
          ]
      }
  }
  ```
  The load time and date format is defined by the ISO 8601 standard. The `ports` field list ports with attached eBPF/XDP
  programs belonging to this pipeline. `objects` contains list of available names that can be used in commands, but does
  not show its type because it is impossible without P4info file (library uses only BTF which is generated by C compiler).

## Port management

- Add port to pipeline:
  ```json
  {
      "name": "veth1",
      "port_id": 6
  }
  ```

## Register

- Get single register entry:
  ```json
  {
      "ingress_reg": [
          {
              "index": {
                  "field0": "0x1"
              },
              "value": {
                  "field0": "0x4",
                  "nested_struct": {
                      "nested_field": "0x5"
                  }
              }
          }
      ]
  }
  ```

- Get all register entries:
  ```json
  {
      "ingress_reg": [
          {
              "index": {
                  "field0": "0x1"
              },
              "value": {
                  "field0": "0x4",
                  "nested_struct": {
                      "nested_field": "0x5"
                  }
              }
          },
          {
              "index": {
                  "field0": "0x2"
              },
              "value": {
                  "field0": "0x5",
                  "nested_struct": {
                      "nested_field": "0x6"
                  }
              }
          }
      ]
  }
  ```
  Note that when register index is wider than 32 bits then entries might not exist unless updated by this library or data
  plane program.

## Table

- Get whole table (no `ternary` nor `lpm` key, used `DirectCounter` and `DirectMeter`):
  ```json
  {
      "ingress_test_tbl": {
          "entries": [
              {
                  "key": [
                      {
                          "type": "exact",
                          "value": "0x1"
                      }
                  ],
                  "action": {
                      "id": 1,
                      "name": "ingress_a1",
                      "parameters": [
                          {
                              "name": "param",
                              "value": "0x1"
                          }
                      ]
                  },
                  "DirectCounter": {
                      "ingress_test3_cnt": {
                          "bytes": "0x4b0",
                          "packets": "0x3"
                      }
                  },
                  "DirectMeter": {
                      "ingress_meter1": {
                          "pir": 2500,
                          "pbs": 250000,
                          "cir": 2500,
                          "cbs": 250000
                      }
                  }
              }
          ],
          "default_action": {
              "action": {
                  "id": 2,
                  "name": "ingress_a2",
                  "parameters": [
                      {
                          "name": "param",
                          "value": "0x64"
                      },
                      {
                          "name": "param2",
                          "value": "0x65"
                      }
                  ]
              },
              "DirectCounter": {
                  "ingress_test3_cnt": {
                      "bytes": "0x0",
                      "packets": "0x0"
                  }
              },
              "DirectMeter": {
                  "ingress_meter1": {
                      "pir": 0,
                      "pbs": 0,
                      "cir": 0,
                      "cbs": 0
                  }
              }
          },
          "DirectCounter": {
              "ingress_test3_cnt": {
                  "type": "PACKETS_AND_BYTES"
              }
          }
      }
  }
  ```
  Note that default entry has the same properties as table entries (excluding key), so it can be used to validate used name
  in case of unsure.

  Possible `type` of DirectCounter is following:
  - `PACKETS_AND_BYTES`
  - `PACKETS`
  - `BYTES`

- Get single table entry (only `exact` match key, no direct objects):
  ```json
  {
      "ingress_test_tbl6": {
          "entries": [
              {
                  "key": [
                      {
                          "type": "exact",
                          "value": "0x1"
                      }
                  ],
                  "action": {
                      "id": 1,
                      "name": "ingress_a1",
                      "parameters": [
                          {
                              "name": "param",
                              "value": "0x1"
                          }
                      ]
                  },
                  "DirectCounter": {},
                  "DirectMeter": {}
              }
          ],
          "DirectCounter": {}
      }
  }
  ```

- Get single table entry (used `lmp` key):
  ```json
  {
      "ingress_test_tbl2": {
          "entries": [
              {
                  "key": [
                      {
                          "type": "lpm",
                          "value": "0x11223300",
                          "prefix_len": 24
                      }
                  ],
                  "action": {
                      "id": 1,
                      "name": "ingress_a1",
                      "parameters": [
                          {
                              "name": "param",
                              "value": "0x1"
                          }
                      ]
                  },
                  "DirectCounter": {},
                  "DirectMeter": {}
              }
          ],
          "DirectCounter": {}
      }
  }
  ```

- Get single table entry (used `ternary` key):
  ```json
  {
      "ingress_test_tbl3": {
          "entries": [
              {
                  "key": [
                      {
                          "type": "ternary",
                          "value": "0x11002233",
                          "mask": "0xff00ffff"
                      }
                  ],
                  "priority": 10,
                  "action": {
                      "id": 1,
                      "name": "ingress_a1",
                      "parameters": [
                          {
                              "name": "param",
                              "value": "0x1"
                          }
                      ]
                  },
                  "DirectCounter": {},
                  "DirectMeter": {}
              }
          ],
          "DirectCounter": {}
      }
  }
  ```
  Note that when `ternary` key is used then others keys are not resolved into `lpm` key. Field which mask has all bits set
  to `care` is shown as `excact` match type.

- Get whole table with implementation (used `ActionProfile`):
  ```json
  {
      "ingress_test_tbl4": {
          "entries": [
              {
                  "key": [
                      {
                          "type": "exact",
                          "value": "0x1"
                      }
                  ],
                  "references": [
                      {
                          "target": "ingress_ap",
                          "member_ref": 1
                      }
                  ]
              }
          ]
      }
  }
  ```

- Get whole table with implementation (used `ActionSelector`):
  ```json
  {
      "ingress_test_tbl5": {
          "entries": [
              {
                  "key": [
                      {
                          "type": "exact",
                          "value": "0x1"
                      }
                  ],
                  "references": [
                      {
                          "target": "ingress_as",
                          "group_ref": 1
                      }
                  ]
              },
              {
                  "key": [
                      {
                          "type": "exact",
                          "value": "0x2"
                      }
                  ],
                  "references": [
                      {
                          "target": "ingress_as",
                          "member_ref": 1
                      }
                  ]
              }
          ]
      }
  }
  ```

- Get whole empty table (no entries):
  ```json
  {
      "ingress_test_tbl6": {
          "entries": [],
          "default_action": {
              "action": {
                  "id": 0,
                  "name": "_NoAction",
                  "parameters": []
              },
              "DirectCounter": {},
              "DirectMeter": {}
          },
          "DirectCounter": {}
      }
  }
  ```

- Get default action only:
  ```json
  {
      "ingress_test_tbl": {
          "default_action": {
              "action": {
                  "id": 2,
                  "name": "ingress_a2",
                  "parameters": [
                      {
                          "name": "param",
                          "value": "0x64"
                      },
                      {
                          "name": "param2",
                          "value": "0x65"
                      }
                  ]
              },
              "DirectCounter": {
                  "ingress_test3_cnt": {
                      "bytes": "0x0",
                      "packets": "0x0"
                  }
              },
              "DirectMeter": {
                  "ingress_meter1": {
                      "pir": 0,
                      "pbs": 0,
                      "cir": 0,
                      "cbs": 0
                  }
              }
          },
          "DirectCounter": {
              "ingress_test3_cnt": {
                  "type": "PACKETS_AND_BYTES"
              }
          }
      }
  }
  ```

## value_set

TODO after fix https://github.com/NIKSS-vSwitch/nikss/issues/71
